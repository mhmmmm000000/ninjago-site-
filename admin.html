<!doctype html>
<html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Admin — Ninjago Marketplace</title><link rel="stylesheet" href="styles.css"></head><body>
  <main style="max-width:1000px;margin:20px auto;padding:16px">
    <h1>Admin — Ninjago Marketplace</h1>
    <div style="display:flex;gap:8px;margin-bottom:12px;align-items:center">
      <input id="pw" class="input" placeholder="Enter admin password">
      <button id="loginBtn" class="btn small">Login</button>
      <span id="loginHint" class="meta">Password stored client-side (not secure)</span>
    </div>

    <div id="adminArea" style="display:none">
      <h2>Orders</h2><div id="ordersList"></div>
      <h2>Requests</h2><div id="requestsList"></div>
      <h2>Feedback</h2><div id="feedbackList"></div>
      <div style="margin-top:16px"><button id="exportAll" class="btn small">Export local data</button></div>
    </div>
  </main>

<script>
const ADMIN_PW = 'M.O.D8643'; // your requested password (client-side only)
const $ = q => document.querySelector(q);

$('#loginBtn').onclick = ()=>{
  const v = $('#pw').value;
  if(v === ADMIN_PW){ $('#adminArea').style.display='block'; $('#loginHint').textContent='Logged in (client-only)'; loadAdmin(); }
  else alert('Wrong password');
};

function loadAdmin(){
  const orders = JSON.parse(localStorage.getItem('nm_orders')||'[]');
  const reqs = JSON.parse(localStorage.getItem('nm_requests')||'[]');
  const fbs = JSON.parse(localStorage.getItem('nm_feedback')||'[]');
  const oEl = $('#ordersList'); const rEl = $('#requestsList'); const fEl = $('#feedbackList');
  oEl.innerHTML = orders.length ? orders.slice().reverse().map(o=>`<div class="card show" style="margin-bottom:8px;padding:10px"><div style="display:flex;justify-content:space-between"><strong>Order ${o.id}</strong><div><button class="small" onclick="delOrder('${o.id}')">Delete</button></div></div><div class="meta">Method: ${o.method||'-'} • Total: SAR ${o.total||0}</div><div class="meta">Name: ${o.name||'-'} • Date: ${o.date||'-'}</div><div style="margin-top:8px">${(o.cart||[]).map(it=>`<div>${it.title} × ${it.qty} — SAR ${it.price}</div>`).join('')}</div></div>`).join('') : '<div class="meta">No orders</div>';
  rEl.innerHTML = reqs.length ? reqs.slice().reverse().map(r=>`<div class="card show" style="margin-bottom:8px;padding:10px"><div style="display:flex;justify-content:space-between"><div>${new Date(r.time).toLocaleString()}</div><div><button class="small" onclick="delReq('${r.id}')">Delete</button></div></div><div style="margin-top:8px" class="msg ${r.from==='user'?'user':'owner'}">${r.name?('<strong>'+r.name+'</strong> — '):''}${r.text}</div></div>`).join('') : '<div class="meta">No requests</div>';
  fEl.innerHTML = fbs.length ? fbs.slice().reverse().map(f=>`<div class="card show" style="margin-bottom:8px;padding:10px"><div style="display:flex;justify-content:space-between"><strong>${f.name||'Anonymous'}</strong><div><button class="small" onclick="delFb('${f.id}')">Delete</button></div></div><div class="meta">${f.email||''}</div><div style="margin-top:8px">${f.text}</div></div>`).join('') : '<div class="meta">No feedback</div>';
}

function delOrder(id){ if(!confirm('Delete order?')) return; let arr = JSON.parse(localStorage.getItem('nm_orders')||'[]'); arr = arr.filter(x=>x.id !== id); localStorage.setItem('nm_orders', JSON.stringify(arr)); loadAdmin(); }
function delReq(id){ if(!confirm('Delete request?')) return; let arr = JSON.parse(localStorage.getItem('nm_requests')||'[]'); arr = arr.filter(x=>x.id !== id); localStorage.setItem('nm_requests', JSON.stringify(arr)); loadAdmin(); }
function delFb(id){ if(!confirm('Delete feedback?')) return; let arr = JSON.parse(localStorage.getItem('nm_feedback')||'[]'); arr = arr.filter(x=>x.id !== id); localStorage.setItem('nm_feedback', JSON.stringify(arr)); loadAdmin(); }

$('#exportAll').onclick = ()=>{
  const data = {orders: JSON.parse(localStorage.getItem('nm_orders')||'[]'), requests: JSON.parse(localStorage.getItem('nm_requests')||'[]'), feedback: JSON.parse(localStorage.getItem('nm_feedback')||'[]')};
  const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'ninjago-local-data.json'; a.click(); URL.revokeObjectURL(a.href);
};
</script>
</body></html>
