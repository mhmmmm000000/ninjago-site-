<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin — Ninjago Marketplace</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
  <main style="max-width:1000px;margin:20px auto;padding:18px">
    <h1>Admin — Ninjago</h1>

    <div id="authBox">
      <p>Enter admin password to view orders & requests.</p>
      <input id="adminPass" class="input" placeholder="Password">
      <div style="display:flex;gap:8px;margin-top:8px"><button id="loginBtn" class="btn">Unlock</button><button id="logoutBtn" class="small">Clear</button></div>
      <p class="meta">Note: This admin check is client-side. For real security use server auth.</p>
    </div>

    <div id="adminPanel" style="display:none">
      <h2>Orders</h2>
      <div style="display:flex;gap:8px;margin-bottom:8px">
        <button id="refreshBtn" class="btn small">Refresh</button>
        <button id="exportOrders" class="small">Export orders JSON</button>
      </div>
      <div id="ordersList"></div>

      <h2>Requests</h2>
      <div id="requestsList"></div>

      <h2>Feedback</h2>
      <div id="feedbackList"></div>
    </div>
  </main>

<script>
const ADMIN_PASS = 'M.O.D8643'; // as requested (client-side check)
const $ = q => document.querySelector(q);

$('#loginBtn').onclick = () => {
  const v = $('#adminPass').value;
  if(v === ADMIN_PASS){
    $('#authBox').style.display = 'none';
    $('#adminPanel').style.display = 'block';
    loadAdminData();
  } else {
    alert('Wrong password');
  }
};
$('#logoutBtn').onclick = () => {
  $('#adminPass').value = '';
  localStorage.removeItem('admin_unlocked');
  $('#authBox').style.display = 'block';
  $('#adminPanel').style.display = 'none';
};

function loadAdminData(){
  const orders = JSON.parse(localStorage.getItem('orders')||'[]');
  const requests = JSON.parse(localStorage.getItem('requests')||'[]');
  const feedback = JSON.parse(localStorage.getItem('feedback')||'[]');

  const ol = $('#ordersList'); ol.innerHTML = '';
  if(orders.length===0) ol.innerHTML = '<div class="meta">No orders yet</div>';
  orders.slice().reverse().forEach(o=>{
    const d = document.createElement('div'); d.className='card show'; d.style.marginBottom='8px';
    d.innerHTML = `<div style="display:flex;justify-content:space-between"><strong>Order ${o.id}</strong><div><button class="small del">Delete</button></div></div>
      <div class="meta">Method: ${o.method||'-'} • Total: SAR ${o.total||o.cart?.reduce((s,i)=>s+i.price*i.qty,0)||0}</div>
      <div class="meta">Name: ${o.name||'-'} • Email: ${o.email||'-'} • Date: ${o.date||'-'}</div>
      <div style="margin-top:8px">${(o.cart||[]).map(it=>`<div>${it.title} × ${it.qty} — SAR ${it.price}</div>`).join('')}</div>
      <div class="meta">Notes: ${o.msg||''}</div>`;
    ol.appendChild(d);
    d.querySelector('.del').onclick = ()=> {
      if(confirm('Delete order?')){
        const arr = orders.filter(x=>x.id !== o.id);
        localStorage.setItem('orders', JSON.stringify(arr));
        loadAdminData();
      }
    };
  });

  const rl = $('#requestsList'); rl.innerHTML = '';
  if(requests.length===0) rl.innerHTML = '<div class="meta">No requests yet</div>';
  requests.slice().reverse().forEach(r=>{
    const d = document.createElement('div'); d.className='card show'; d.style.marginBottom='8px';
    d.innerHTML = `<div style="display:flex;justify-content:space-between"><div>${new Date(r.time||Date.now()).toLocaleString()}</div><div><button class="small rdel">Delete</button></div></div><div class="msg user" style="padding:8px;margin-top:8px">${r.type?'<strong>'+r.type+'</strong> - ':''}${r.text}</div>`;
    rl.appendChild(d);
    d.querySelector('.rdel').onclick = ()=> {
      if(confirm('Delete request?')){
        const arr = requests.filter(x=>x.id !== r.id);
        localStorage.setItem('requests', JSON.stringify(arr));
        loadAdminData();
      }
    };
  });

  const fl = $('#feedbackList'); fl.innerHTML = '';
  if(feedback.length===0) fl.innerHTML = '<div class="meta">No feedback yet</div>';
  feedback.slice().reverse().forEach(f=>{
    const d = document.createElement('div'); d.className='card show'; d.style.marginBottom='8px';
    d.innerHTML = `<div style="display:flex;justify-content:space-between"><div>${new Date(f.created||Date.now()).toLocaleString()}</div><div><button class="small fdel">Delete</button></div></div><div style="margin-top:8px"><strong>${f.name||'Anonymous'}</strong> — ${f.email||''}</div><div style="margin-top:8px">${f.msg}</div>`;
    fl.appendChild(d);
    d.querySelector('.fdel').onclick = ()=> {
      if(confirm('Delete feedback?')){
        const arr = feedback.filter(x=>x.id !== f.id);
        localStorage.setItem('feedback', JSON.stringify(arr));
        loadAdminData();
      }
    };
  });
}

$('#refreshBtn').onclick = loadAdminData;
$('#exportOrders').onclick = ()=> {
  const data = localStorage.getItem('orders') || '[]';
  const blob = new Blob([data], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'orders.json'; a.click(); URL.revokeObjectURL(a.href);
};
</script>
</body>
</html>
