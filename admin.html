<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ninjago Vault — Admin</title>
<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="bg-gray-900 text-gray-100">
  <div class="max-w-6xl mx-auto px-6 py-8">
    <h1 class="text-3xl font-bold">Admin — Orders</h1>
    <div id="accessNotice" class="mt-4"></div>
    <div id="ordersArea" class="mt-6"></div>
    <div class="mt-6">
      <button id="clearOrders" class="px-4 py-2 rounded-xl bg-red-600">Clear orders (local demo)</button>
    </div>
  </div>

<script>
function showAccessDenied(){
  document.getElementById('accessNotice').innerHTML = '<div class="text-red-400">Access denied — admin unlock not found. Use the secret Ctrl+Shift + click on the site logo to open admin.</div>';
  document.getElementById('ordersArea').innerHTML = '';
  document.getElementById('clearOrders').style.display = 'none';
}

function loadOrders(){
  if(sessionStorage.getItem('admin_unlocked') !== '1') {
    showAccessDenied();
    return;
  }
  document.getElementById('accessNotice').innerHTML = '<div class="text-green-400">Admin access OK for this session.</div>';
  const all = JSON.parse(localStorage.getItem('orders_all') || '[]').reverse();
  if(all.length === 0) {
    document.getElementById('ordersArea').innerHTML = '<div class="text-gray-400 mt-4">No orders yet.</div>';
    return;
  }
  document.getElementById('ordersArea').innerHTML = all.map(o => {
    return `<div class="border rounded-xl p-4 mb-3 bg-gray-800">
      <div class="flex justify-between"><div><strong>Order ID:</strong> ${o.id}</div><div class="text-sm text-gray-400">${new Date(o.created).toLocaleString()}</div></div>
      <div class="mt-2"><strong>Email:</strong> ${o.email}</div>
      <div class="mt-2"><strong>Method:</strong> ${o.method} ${o.paid ? ' • paid: ' + o.paid : ''}</div>
      <div class="mt-2"><strong>Total:</strong> SAR ${o.total}</div>
      <div class="mt-2"><strong>Items:</strong> ${ (o.items||[]).map(it=>escapeHtml(it.title) + ' ×'+it.qty).join(', ') }</div>
      <div class="mt-2 text-sm text-gray-400">Note: this admin is client-side demo — orders stored in localStorage.</div>
    </div>`;
  }).join('');
}

function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

document.getElementById('clearOrders').onclick = ()=>{
  if(!confirm('Clear all orders from localStorage for this browser?')) return;
  localStorage.removeItem('orders_all');
  loadOrders();
};

loadOrders();
</script>
</body>
</html>
