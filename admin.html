<!doctype html>
<html lang="en">
<head><meta charset="utf-8"/><meta name="viewport"content="width=device-width,initial-scale=1"/><title>Admin — Ninjago Market</title><link rel="stylesheet" href="styles.css"></head>
<body>
<main style="max-width:1100px;margin:28px auto;padding:16px">
  <h1>Admin</h1>
  <div id="loginArea">
    <p>Enter admin password to unlock admin tools.</p>
    <input id="pw" class="input" placeholder="Password" type="password">
    <button id="loginBtn" class="btn">Unlock</button>
    <div id="loginMsg" class="hint"></div>
  </div>

  <div id="adminArea" style="display:none">
    <h2>Orders</h2>
    <div id="ordersList"></div>
    <h2>Requests</h2>
    <div id="requestsList"></div>
    <h2>Products</h2>
    <div id="productsList"></div>
  </div>
</main>

<script>
// NOTE: This is client-side gate only. It prevents casual visitors from opening the admin page accidentally.
// For production, use server-side authentication.
const storedHash = '617ff591a17bd881fc46377829724aab9834d98447888bacfb72e5821881ef86'; // SHA-256 of default password 'ninjagoadmin2025'

async function sha256hex(msg){
  const enc = new TextEncoder().encode(msg);
  const hash = await crypto.subtle.digest('SHA-256', enc);
  return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

$('#loginBtn').onclick = async ()=>{
  const pw = $('#pw').value || '';
  const h = await sha256hex(pw);
  if(h === storedHash){
    $('#loginArea').style.display = 'none'; $('#adminArea').style.display = 'block';
    loadAdmin();
  } else {
    $('#loginMsg').innerText = 'Invalid password';
  }
};

function $(q){return document.querySelector(q);}
function loadAdmin(){
  // load from local storage (demo)
  const orders = JSON.parse(localStorage.getItem('orders')||'[]');
  const requests = JSON.parse(localStorage.getItem('requests')||'[]');
  const products = JSON.parse(localStorage.getItem('products')||'[]');

  const ol = $('#ordersList'); ol.innerHTML = '';
  if(orders.length===0) ol.innerHTML = '<div class="meta">No orders</div>';
  orders.slice().reverse().forEach(o=>{
    const d = document.createElement('div'); d.className='card show'; d.style.marginBottom='8px';
    d.innerHTML = `<div style="display:flex;justify-content:space-between"><strong>${o.id}</strong><div>${o.method||''}</div></div><div class="meta">Name: ${o.name||'-'} Email: ${o.email||'-'}</div><div>${(o.cart||[]).map(it=>`<div>${it.title} ×${it.qty} — SAR ${it.price}</div>`).join('')}</div>`;
    ol.appendChild(d);
  });

  const rl = $('#requestsList'); rl.innerHTML = requests.length ? requests.map(r=>`<div class="card show" style="margin-bottom:8px"><div class="msg ${r.from==='user'?'user':'owner'}">${r.text}</div></div>`).join('') : '<div class="meta">No requests</div>';

  // products: read products.json (if accessible) and show quick list
  fetch('products.json').then(r=>r.json()).then(list=>{
    const pl = $('#productsList'); pl.innerHTML = list.map(p=>`<div class="card show" style="margin-bottom:8px"><strong>${p.title}</strong> <div class="meta">SAR ${p.price_sar || p.price_discount || '-'}</div></div>`).join('') || '<div class="meta">No products found</div>';
  }).catch(e=>{ $('#productsList').innerHTML = '<div class="meta">Failed to load products.json</div>'; });
}
</script>
</body>
</html>
