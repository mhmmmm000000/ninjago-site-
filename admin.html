<!doctype html>
<html lang="en">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Admin — Ninjago</title><link rel="stylesheet" href="styles.css"></head>
<body>
  <main style="max-width:1000px;margin:24px auto;padding:16px">
    <h1>Admin — Ninjago</h1>
    <div id="authArea">
      <p>Enter admin password:</p>
      <input id="adminPwd" class="input" placeholder="Password">
      <button id="adminLogin" class="btn">Login</button>
      <div id="authMsg" class="meta"></div>
    </div>
    <div id="adminActions" style="display:none">
      <h2>Orders</h2><div id="ordersList"></div>
      <h2>Requests</h2><div id="requestsList"></div>
      <h2>Feedback</h2><div id="feedbackList"></div>
    </div>
  </main>

<script>
const $ = s=>document.querySelector(s);
async function getAdminJson(){
  try{ const r = await fetch('admin.json'); return await r.json(); }catch(e){ return {admin_password:''}; }
}
$('#adminLogin').onclick = async ()=>{
  const entered = $('#adminPwd').value.trim();
  const adm = await getAdminJson();
  if(entered === adm.admin_password){
    $('#authArea').style.display='none'; $('#adminActions').style.display='block';
    loadAdminData();
  } else { $('#authMsg').textContent='Wrong password'; $('#adminPwd').value=''; }
};
function loadAdminData(){
  const orders = JSON.parse(localStorage.getItem('orders')||'[]');
  const reqs = JSON.parse(localStorage.getItem('requests')||'[]');
  const fbs = JSON.parse(localStorage.getItem('feedback')||'[]');
  const ordEl = $('#ordersList'); ordEl.innerHTML = orders.length ? orders.slice().reverse().map(o=>`<div class="card"><strong>Order ${o.id}</strong><div class="meta">Method: ${o.method||'-'} • Total: SAR ${o.total||0}</div><div>${(o.items||o.cart||[]).map(i=>i.title?i.title:i).join('<br>')}</div></div>`).join('') : '<div class="meta">No orders</div>';
  const reqEl = $('#requestsList'); reqEl.innerHTML = reqs.length ? reqs.slice().reverse().map(r=>`<div class="card"><div class="meta">${new Date(r.time||Date.now()).toLocaleString()}</div><div>${r.name?'<strong>'+r.name+'</strong> — ':''}${r.text}</div></div>`).join('') : '<div class="meta">No requests</div>';
  const fbEl = $('#feedbackList'); fbEl.innerHTML = fbs.length ? fbs.slice().reverse().map(f=>`<div class="card"><div class="meta">${new Date(f.time).toLocaleString()}</div><div><strong>${f.name||'Guest'}</strong></div><div>${f.text}</div></div>`).join('') : '<div class="meta">No feedback</div>';
}
</script>
</body>
</html>
